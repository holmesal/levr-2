<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src='http://api.tiles.mapbox.com/mapbox.js/v0.6.6/mapbox.js'></script>
      <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/css/other.css" rel='stylesheet' />
  
  <link href='http://api.tiles.mapbox.com/mapbox.js/v0.6.6/mapbox.css' rel='stylesheet' />
  <link href="/css/landing_v4.css" rel='stylesheet' />
</head>
<body class="right">

<div class="navbar navbar-fixed-top">
	  	<div class="navbar-inner">
		  	<div class="container">
			  	<a class="brand" href="#">Levr</a>
			  	<!a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
			  		<ul class="nav" id='navigation'>
				  		<li class="wide"><a href='http://www.levr.com'>Offers</a></li>
				  		<li class="wide"><a href='http://www.levr.com/merchants'>Merchants</a></li>
				  		<li class="wide"><a href='http://www.getradi.us'>Developers</a></li>
			  		</ul>
			  	<!/a>
			  	
		  	</div>
	  	</div>
  	</div>
  	<div id="content"><div class="limiter hidden-phone">
        <div id="about">
        	<h1>Welcome to Levr.</h1>
        	<div class="sectionDiv">
	    		<img class='sectionIcon' src="/img/city.png">
	        	<h3 class="sectionText">Levr helps you discover great offers at local businesses.</h3>
        	</div>
        	<div class="sectionDiv">
	    		<img class='sectionIcon' src="/img/community.png">
	        	<h3 class="sectionText">Offers on Levr are uploaded and curated by your community.</h3>
        	</div>
        	
          <h1 class='map-title'></h1>
          <p class='description'></p>
          <div id="markerfilters" class="clearfix section">
            <h3>Download Levr for iPhone:</h3>
            <a href='https://itunes.apple.com/us/app/levr/id564566794?mt=8'><img id='appstore' src="/img/appstore.png"></a>
          </div>
        </div>
        <!--div data-control='geocode' class="clearfix section" id="search">
          <form class="geocode">
            <input placeholder='Search for an address' type="text">
            <input type='submit' />
            <div id='geocode-error'></div>
          </form>
        </div-->
  	
  	
<div id='mapContainer'>
<div id='map'></div>
</div>

<script src="http://code.jquery.com/jquery-latest.js"></script>
<script>

    // GeoJSON input features
    // The image and url properties of the features will be used in
    // the tooltips
    /*var features = [{
        "geometry": { "type": "Point", "coordinates": [-77.03, 38.90]},
        "properties": {
            "image": "http://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/DCmontage4.jpg/250px-DCmontage4.jpg",
            "url": "http://en.wikipedia.org/wiki/Washington,_D.C.",
            "city": "Washington, D.C."
        }
    }, {
        "geometry": { "type": "Point", "coordinates": [-87.63, 41.88]},
        "properties": {
            "image": "http://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Chicago_montage.jpg/300px-Chicago_montage.jpg",
            "url": "http://en.wikipedia.org/wiki/Chicago",
            "city": "Chicago"
        }
    }, {
        "geometry": { "type": "Point", "coordinates": [-74.00, 40.71]},
        "properties": {
            "image": "http://upload.wikimedia.org/wikipedia/commons/thumb/b/bb/NYC_Montage_2011.jpg/275px-NYC_Montage_2011.jpg",
            "url": "http://en.wikipedia.org/wiki/New_York_City",
            "city": "New York City"
        }
    }];*/
    
    
    
    
/*
    mapbox.auto('map','http://a.tiles.mapbox.com/v3/alonsoholmes.map-7b8eyy4m.jsonp',function(map){
	
    
	    var features = [
	    {% for deal in deals %}
	    {
	        "geometry": { "type": "Point", "coordinates": [{{deal.business.geoPoint}}]},
	        "properties": {
	            "image": "{{deal.largeImg}}"
	        }
	    },
	    {% endfor %}
	    ];
	
	    // Create map
	    //var map = mapbox.map('map');
	    //mapbox.auto('map', 'examples.map-vyofok3q');
	    //var map = mapbox.auto('map','alonsoholmes.map-7b8eyy4m');
	    //var map = mapbox.load('examples.map-vyofok3q',doStuff())
	    
	    map.addLayer(mapbox.layer().id('alonsoholmes.map-7b8eyy4m'));
	
	    // Create and add marker layer
	    var markerLayer = mapbox.markers.layer().features(features);
	    var interaction = mapbox.markers.interaction(markerLayer);
	    map.addLayer(markerLayer);
	
	    // Set a custom formatter for tooltips
	    // Provide a function that returns html to be used in tooltip
	    interaction.formatter(function(feature) {
	        var o = '<a target="_blank" href="' + feature.properties.url + '">' +
	            '<img src="' + feature.properties.image + '">' +
	            '<h2>' + feature.properties.city + '</h2>' +
	            '</a>';
	
	        return o;
	    });
    });
*/
    
    mapbox.load('http://a.tiles.mapbox.com/v3/alonsoholmes.map-7b8eyy4m.jsonp', function(o) {
	    var map = mapbox.map('map');
	    
	    map.setZoomRange(3,20)
	    map.ui.zoomer.add()
	
    
	    var features = [
	    {% for deal in deals %}
	    {
	        "geometry": { "type": "Point", "coordinates": [{{deal.lon}},{{deal.lat}}]},
	        "properties": {
	            "img"			: 	"{{deal.imgURL}}",
	            "deal_text"		:	"{{deal.dealText}}",
	            "description"	:	"{{deal.description}}",
	            "location"		:	"{{deal.business.businessName}} - {{deal.business.vicinity}}",
	            "userImg"		:	"{{deal.owner.photoURL}}",
	            "userName"		:	"{{deal.owner.alias}}"
	        }
	    },
	    {% endfor %}
	    ];
	
	    // Create map
	    //var map = mapbox.map('map');
	    //mapbox.auto('map', 'examples.map-vyofok3q');
	    //var map = mapbox.auto('map','alonsoholmes.map-7b8eyy4m');
	    //var map = mapbox.load('examples.map-vyofok3q',doStuff())
	    
	    map.addLayer(mapbox.layer().id('alonsoholmes.map-7b8eyy4m'));
	
	    // Create and add marker layer
	    var markerLayer = mapbox.markers.layer().features(features);
	    var interaction = mapbox.markers.interaction(markerLayer);
	    map.addLayer(markerLayer);
	
	    // Set a custom formatter for tooltips
	    // Provide a function that returns html to be used in tooltip
	    interaction.formatter(function(feature) {
	        /*var o = '<a target="_blank" href="' + feature.properties.url + '">' +
	            '<img src="' + feature.properties.image + '">' +
	            '<h2>' + feature.properties.city + '</h2>' +
	            '</a>';*/
	        
	        //var o = '<div class="imgDiv" style="background-image:url('+feature.properties.img+');"><div class="infoDiv"><p class="deal_text">'+feature.properties.deal_text+'</p><p class="description">'+feature.properties.description+'</p><p class="location">'+feature.properties.location+'</p><div class="userDiv"><div style="background-image:url('+feature.properties.userImg+');" class="userImg"></div><div class="userText"> Found by '+feature.properties.userName+' on Levr for iPhone.</br>At: Some place.</div></div></div></div>'
	        
	        var o = '<div class="imgDiv" style="background-image:url('+feature.properties.img+');"><div class="infoDiv"><p class="deal_text">'+feature.properties.deal_text+'</p><p class="description">'+feature.properties.description+'</p><div class="userDiv"><div style="background-image:url('+feature.properties.userImg+');" class="userImg"></div><div class="userText"> Found by '+feature.properties.userName+' on Levr for iPhone at:</br>'+feature.properties.location+'</div></div></div></div>'
	
	        return o;
	    });
	    
	    // Set iniital center and zoom
    map.centerzoom({
        lat: 42.3583,
        lon: -71.0603
    }, 15);
    
    });

    
</script>

<div class="imgDiv"><p class="deal_text"></p><p class="description"></p><p class="business_name"></p><p class="vicinity"></p></div>


</body>
</html>